<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="testResultDAO">
	
	<!-- 작성자 김혜민 -->
	<!-- 교수 성적 입력 -->
	<insert id="insertTestResult" parameterType="testResultVO">
	
		INSERT INTO TESTRESULT (TESTRESULTNUM,
								TESTSCORE,
								TESTNUM,
								CLASSAPPLYNUM)
					VALUES (#{testresultnum},
							#{testscore},
							#{testnum},
							#{classapplynum})
	</insert>
	
<<<<<<< HEAD
	<!-- 온라인 시험 성적 수정 -->
	<update id = "updateTestResult" parameterType="testResultVO">
=======
	<!-- 교수 성적 수정 -->
	<update id = "testResultUpdate" parameterType="testResultVO">
>>>>>>> branch 'master' of https://github.com/signor11/LMSgodC
		UPDATE TESTRESULT 
		SET    TESTSCORE=#{testscore},
			   TESTNUM=#{testnum},
			   CLASSAPPLYNUM=#{classapplynum},
			   STUDENTNUM=#{studentnum},
			   CLASSNUM=#{classnum}
			   WHERE TESTRESULTNUM=#{testresultnum}
	</update>
	
	<!-- 과목 성적 수정 -->
	<update id="updateClassapply" parameterType="testResultVO">
		UPDATE CLASSAPPLY 
		SET    CLASSAPPLYNUM=#{classapplynum},
			   STUDENTNUM = #{studentnum},
			   CLASSNUM = #{classnum},
			   SCORE = #{score}
		WHERE  CLASSAPPLYNUM = #{classapplynum}
	
	</update> 
	
	<!-- 단건 조회 -->
<<<<<<< HEAD

	<select id="gettestresult" resultType="testResultVO">

=======
	<select id="gettestresult" parameterType="string" resultType="testResultVO">
>>>>>>> branch 'master' of https://github.com/signor11/LMSgodC
		SELECT *
		FROM TESTRESULT
		WHERE  TESTRESULTNUM= #{testresultnum}
	</select>
	
	<!-- 교수 성적 조회 -->
<<<<<<< HEAD

	<select id="getTestresultList" resultType="testResultVO">

=======
	
	<select id="getBoardList" resultType="testResultVO">
>>>>>>> branch 'master' of https://github.com/signor11/LMSgodC
		SELECT C.CLASSNUM,
			   C.CLASSAPPLYNUM,
			   C.STUDENTNUM,
			   C.SCORE,
			   TR.TESTRESULTNUM,
			   TR.TESTSCORE,
			   TR.TESTNUM,
			   S.STUDENTNAME,
			   GRADE_TOTAL(C.SCORE) AS GRADE,
			   SCORE_TOTAL(C.SCORE) AS SCORET
	   FROM CLASSAPPLY C JOIN STUDENT S 
			ON (S.STUDENTNUM = C.STUDENTNUM) 
			LEFT OUTER JOIN TESTRESULT TR 
			ON (C.CLASSAPPLYNUM = TR.CLASSAPPLYNUM)
	   WHERE 1=1 
	   <if test="classnum != null and classnum != ''">
			AND  C.CLASSNUM = #{classnum}
	   </if>
	  ORDER BY CLASSAPPLYNUM
	</select>
	
	<!-- 학생 성적 조회 -->
	<select id="gettestresultListstu" resultType="testResultVO">
		SELECT C.CLASSNUM,
			   C.CLASSAPPLYNUM,
			   C.STUDENTNUM,
			   C.SCORE,
			   CL.CREDIT,
			   CL.CLASSNAME,
			   TR.TESTRESULTNUM,
			   TR.TESTSCORE,
			   TR.TESTNUM,
			   S.STUDENTNAME,
			   P.PROFESSORNAME,
			   GRADE_TOTAL(C.SCORE) AS GRADE,
			   SCORE_TOTAL(C.SCORE) AS SCORET
			   FROM CLASSAPPLY C JOIN TESTRESULT TR 
					ON (C.CLASSAPPLYNUM = TR.CLASSAPPLYNUM) 
					JOIN STUDENT S ON (S.STUDENTNUM = C.STUDENTNUM)
				    JOIN CLASS CL ON (C.CLASSNUM = CL.CLASSNUM)
				    JOIN PROFESSOR P ON (P.PROFESSORNUM = CL.PROFESSORNUM)
			  WHERE 1=1 
			   <if test="studentnum != null and studentnum != ''">
					AND S.STUDENTNUM = #{studentnum}
			   </if>
			   <if test="classname != null and classname != ''">
					AND CL.CLASSNAME = #{classname}
			   </if>
			   <if test="credit != null and credit != ''">
			   		AND CL.CREDIT = #{credit}	
			   </if>	
			   <if test="score != null and score != ''">
			   		AND C.SCORE = #{score}	
			   </if>
			   <if test="classapplynum != null and classapplynum != ''">
			   		AND C.CLASSAPPLNUM = #{classapplynum}	
			   </if>
			  ORDER BY CLASSAPPLYNUM
	</select>
	<!-- 성적표 출력
	<select id="transcript" resultType="testResultVO">
		SELECT S.STUDENTNUM,
				MAJORNAME,
				C.CLASSNUM,
				CLASSNAME, 
				GRADE_TOTAL(C.SCORE) AS GRADE,
				SCORE_TOTAL(C.SCORE) AS SCORET,
				C.SCORE,
				C.CLASSAPPLYNUM,
				CL.CREDIT 
		FROM CLASSAPPLY C JOIN STUDENT S ON (S.STUDENTNUM = C.STUDENTNUM) 
		JOIN MAJOR M ON (S.MAJORNUM = M.MAJORNUM)
		JOIN CLASS CL ON (C.CLASSNUM = CL.CLASSNUM)  
		JOIN TESTRESULT TR ON (C.CLASSAPPLYNUM=TR.CLASSAPPLYNUM)
		WHERE 1=1
		<if test="studentnum != null and studentnum != ''">
			AND S.STUDENTNUM = #{studentnum}
	   </if>
	   <if test="classnum != null and classnum != ''">
	   		AND CL.CLASSNUM = #{classnum}	
	   </if>	
	   <if test="classname != null and classname != ''">
			AND CL.CLASSNAME = #{classname}
	   </if>
	   <if test="majorname != null and majorname != ''">
	   		AND M.MAJORANME = #{majorname}	
	   </if>
	   <if test="classapplynum != null and classapplynum != ''">
	   		AND C.CLASSAPPLNUM = #{classapplynum}	
	   </if>
	</select> -->
</mapper>