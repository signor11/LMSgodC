<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.yedam.lms.smp.impl.StudentDAO">

	<!-- 단건조회 -->
	<select id="getStudent" parameterType="string" resultType="com.yedam.lms.smp.StudentVO">
		
		SELECT s.STUDENTNUM,
			   s.MAJORNUM,
			   m.MAJORNAME,
			   s.STUDENTPW,
			   s.STUDENTNAME,
			   s.STUDENTPHONE,
			  TO_CHAR(s.STARTDATE, 'YYYY-MM-DD') STARTDATE
			   
		FROM STUDENT s JOIN MAJOR m
    	ON s.MAJORNUM = m.MAJORNUM
		WHERE STUDENTNUM = #{studentnum}
	</select>
	<!-- 로그인 -->
	<select id="getLogin" resultType="com.yedam.lms.smp.StudentVO">
		
	  SELECT STUDENTNUM as "studentnum",
	   		 STUDENTPW as "studentpw",
	   		 STUDENTNAME as "studentname",
	   		 USERTYPE as "usertype"
	  FROM VLOG 
	  WHERE STUDENTNUM= #{studentnum} and STUDENTPW= #{studentpw}
	</select>
	
	
	<!-- 전체조회 -->
	<select id="getStudentList" resultType="map">
		
		SELECT a.* FROM(SELECT ROWNUM rn, b.* FROM (
			SELECT s.STUDENTNUM,
			   s.MAJORNUM,
			   m.MAJORNAME,
			   s.STUDENTPW,
			   s.STUDENTNAME,
			   s.STUDENTPHONE,
			   TO_CHAR(s.STARTDATE, 'YYYY-MM-DD') STARTDATE
		 	FROM STUDENT s JOIN MAJOR m
     		ON s.MAJORNUM = m.MAJORNUM
     		ORDER BY STUDENTNUM
		 ) b ) a
		 WHERE rn between #{start} and  #{end}
  
	</select>
	
	<!-- 입력 -->
	<insert id = "insertStudent" parameterType="com.yedam.lms.smp.StudentVO">
		<selectKey keyProperty="studentNum" resultType="string" order="BEFORE">
			SELECT nvl(max(SEQ),0)+1 FROM STUDENT
		</selectKey>
			INSERT INTO STUDENT(STUDENTNUM,
								MAJORNUM,
								STUDENTPW,
								STUDENTNAME,
								STUDENTPHONE,
								STARTDATE)
			VALUES (#{studentnum},
					#{majornum},
					#{studentpw},
					#{studentname},
					#{studentphone},
					#{startdate})
	</insert>
	
	<!-- 수정 -->
	<update id="updateStudent"  parameterType="com.yedam.lms.smp.StudentVO">
		UPDATE STUDENT
		SET	   MAJORNUM=#{majornum},
			   STUDENTPW=#{studentpw},
			   STUDENTPHONE=#{studentphone},
			   STUDENTNAME=#{studentname},
			   STARTDATE=#{startdate}
		WHERE  STUDENTNUM=#{studentnum}
	</update>
	
	<!-- 삭제 -->
	<delete id = "deleteStudent" parameterType="com.yedam.lms.smp.StudentVO">
		DELETE FROM STUDENT
		WHERE STUDENTNUM=#{studentnum}
	</delete>
	
	<!-- 건수 조회 -->
	<select id="studentCount" resultType="integer">
		SELECT COUNT(*) FROM STUDENT S JOIN MAJOR M
						ON S.MAJORNUM = M.MAJORNUM
	</select>
</mapper>
